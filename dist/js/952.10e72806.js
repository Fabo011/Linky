"use strict";(self["webpackChunklinky"]=self["webpackChunklinky"]||[]).push([[952],{1031:function(e,t,s){s.d(t,{c:function(){return h}});var a=s(4108);const n={xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-send",viewBox:"0 0 16 16"},r=(0,a.QD)("path",{d:"M15.854.146a.5.5 0 0 1 .11.54l-5.819 14.547a.75.75 0 0 1-1.329.124l-3.178-4.995L.643 7.184a.75.75 0 0 1 .124-1.33L15.314.037a.5.5 0 0 1 .54.11ZM6.636 10.07l2.761 4.338L14.13 2.576 6.636 10.07Zm6.787-8.201L1.591 6.602l4.339 2.76 7.494-7.493Z"},null,-1),o=[r];function c(e,t,s,r,c,i){return(0,a.Wz)(),(0,a.An)("svg",n,o)}var i=(0,a._M)({name:"TheChatBtnIcon.vue"}),u=s(6482);const l=(0,u.c)(i,[["render",c]]);var h=l},6904:function(e,t,s){s.d(t,{c:function(){return l}});var a=s(4108),n=s(7764);function r(e,t,s,r,o,c){return(0,a.wt)(((0,a.Wz)(),(0,a.An)("input",{type:"search","onUpdate:modelValue":t[0]||(t[0]=t=>e.searchValue=t),onInput:t[1]||(t[1]=(...t)=>e.pushSearchValue&&e.pushSearchValue(...t)),class:"form-control w-100 mt-1",placeholder:"Search"},null,544)),[[n.Og,e.searchValue]])}var o=s(8948),c=(0,a._M)({name:"SearchBar",data(){return{searchValue:""}},methods:{pushSearchValue(){const e=this.searchValue.toLowerCase();o.i.setSearchValue(e)}}}),i=s(6482);const u=(0,i.c)(c,[["render",r]]);var l=u},5906:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var a=s(4108),n=s(9096),r=s(7764),o=s.p+"media/newMessageSound.b4b99630.mp3";const c=e=>((0,a.ED)("data-v-27ecd15a"),e=e(),(0,a.ii)(),e),i={ref:"newMessageSound",controls:""},u=c((()=>(0,a.QD)("source",{type:"audio/mpeg",src:o},null,-1))),l={class:"chat-container"},h={key:0,class:"message-block"},d={class:"user-avatar"},m={class:"message-username"},v=c((()=>(0,a.QD)("br",null,null,-1))),p={class:"message-text"},g={key:1,class:"friend-message-block"},f={class:"friend-avatar"},w={class:"message-friend"},M=c((()=>(0,a.QD)("br",null,null,-1))),b={class:"message-text"};function T(e,t,s,o,c,T){const C=(0,a.E1)("ChatNav"),x=(0,a.E1)("ChatDeleteBtn"),D=(0,a.E1)("TheFooter");return(0,a.Wz)(),(0,a.An)(a.ae,null,[(0,a.K2)(C),(0,a.QD)("audio",i,[u,(0,a.mY)(" Your browser does not support the audio element. ")],512),(0,a.QD)("div",l,[((0,a.Wz)(!0),(0,a.An)(a.ae,null,(0,a.mi)(e.messages,(t=>((0,a.Wz)(),(0,a.An)("div",{key:t.id},[e.user===t.username?((0,a.Wz)(),(0,a.An)("div",h,[(0,a.QD)("span",d,(0,n.WA)(t.username.slice(0,2)),1),(0,a.QD)("span",m,(0,n.WA)(t.username),1),(0,a.K2)(x,{onClick:(0,r.Y7)((s=>e.deleteMessage(t.id)),["prevent"])},null,8,["onClick"]),v,(0,a.QD)("span",p,(0,n.WA)(t.message),1)])):(0,a.g1)("",!0),e.user!==t.username?((0,a.Wz)(),(0,a.An)("div",g,[(0,a.QD)("span",f,(0,n.WA)(t.username.slice(0,2)),1),(0,a.QD)("span",w,(0,n.WA)(t.username),1),M,(0,a.QD)("span",b,(0,n.WA)(t.message),1)])):(0,a.g1)("",!0)])))),128))]),(0,a.K2)(D)],64)}s(4256),s(1960);var C=s(2652),x=s(3927),D=s(8948),S=s(911);const k={id:"nav",class:"navbar sticky-top justify-content-center"},y={class:"d-flex"},B={class:"d-flex align-items-center justify-content-center"};function _(e,t,s,n,o,c){const i=(0,a.E1)("TheTextarea"),u=(0,a.E1)("ChatSendBtn"),l=(0,a.E1)("router-view");return(0,a.Wz)(),(0,a.An)(a.ae,null,[(0,a.QD)("nav",k,[(0,a.QD)("div",y,[(0,a.QD)("img",{class:"navbar-brand ms-1",src:S,id:"logo",href:"#",onClick:t[0]||(t[0]=(0,r.Y7)(((...t)=>e.home&&e.home(...t)),["prevent"]))}),(0,a.QD)("nav",null,[(0,a.QD)("div",B,[(0,a.K2)(i),(0,a.K2)(u)])])])]),(0,a.K2)(l)],64)}var E=s(1240),A=s(6904),Q=s(6276),W=s(3083);function R(e,t,s,n,o,c){const i=(0,a.E1)("ChatBtnIcon");return(0,a.Wz)(),(0,a.An)("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(0,r.Y7)(((...t)=>e.sendMessage&&e.sendMessage(...t)),["prevent"]))},[(0,a.K2)(i)])}function V(e){return{all:e=e||new Map,on:function(t,s){var a=e.get(t);a?a.push(s):e.set(t,[s])},off:function(t,s){var a=e.get(t);a&&(s?a.splice(a.indexOf(s)>>>0,1):e.set(t,[]))},emit:function(t,s){var a=e.get(t);a&&a.slice().map((function(e){e(s)})),(a=e.get("*"))&&a.slice().map((function(e){e(t,s)}))}}}const I=V();var z=I,K=s(1031),L=(0,a._M)({name:"TheChatSendBtn.vue",components:{ChatBtnIcon:K.c},methods:{sendMessage(){z.emit("sendMessage")}}}),N=s(6482);const U=(0,N.c)(L,[["render",R],["__scopeId","data-v-08d01e40"]]);var Y=U;function G(e,t,s,n,o,c){return(0,a.wt)(((0,a.Wz)(),(0,a.An)("textarea",{type:"search","onUpdate:modelValue":t[0]||(t[0]=t=>e.text=t),onInput:t[1]||(t[1]=(...t)=>e.pushText&&e.pushText(...t)),class:"form-control inp-search w-100 area",placeholder:"message"},null,544)),[[r.Og,e.text]])}var $=(0,a._M)({name:"TheTextarea.vue",created(){this.receiveMessageEventBus()},data(){return{text:""}},methods:{pushText(){D.i.setChatTextValue(this.text)},receiveMessageEventBus(){z.on("clearChatTextarea",(()=>{this.text=""}))}}});const O=(0,N.c)($,[["render",G],["__scopeId","data-v-4c994511"]]);var Z=O,j=(0,a._M)({name:"TheNavbar.vue",components:{CreateAndSaveNewLinkVue:E.c,SearchBar:A.c,CreateChatRoom:Q.c,TheServiceSelector:W.c,TheTextarea:Z,ChatSendBtn:Y},beforeRouteEnter(){D.i.authStatusRefresh()},data(){return{store:D.i,username:D.i.username,refresh:"",searchValue:""}},methods:{home(){this.$router.push("/profile")}}});const q=(0,N.c)(j,[["render",_],["__scopeId","data-v-6293d56d"]]);var F=q;const H={type:"button",class:"chat-delete-btn"};function J(e,t,s,n,r,o){const c=(0,a.E1)("TheTrashIcon");return(0,a.Wz)(),(0,a.An)("button",H,[(0,a.K2)(c)])}var P=s(7448),X=(0,a._M)({name:"TheChatDeleteBtn.vue",components:{TheTrashIcon:P.c}});const ee=(0,N.c)(X,[["render",J],["__scopeId","data-v-3b583a95"]]);var te=ee,se=s(8664),ae=(0,a._M)({name:"ChatRoom.vue",components:{TheFooter:C.c,ChatNav:F,ChatDeleteBtn:te},beforeMount(){this.loadChatRoom(),this.fetchMessages(),this.loadUsername()},created(){this.receiveMessageEventBus(),this.realtimeListener(),this.scrollToBottom()},async beforeRouteEnter(){D.i.authStatusRefresh(),await D.i.checkUser()},updated(){this.$nextTick((()=>this.scrollToBottom()))},data(){return{store:D.i,user:D.i.username,newMessage:"",messages:[],chatRoom:""}},methods:{async fetchMessages(){const{data:e,error:t}=await x.G.from("chat").select("*").eq("chatRoom",this.chatRoom),s=e?.map((e=>{const t=(0,se.i_)(e.message);return{...e,message:t}}));if(this.messages=s,t)throw new Error("fetch chat message failed.")},async sendMessage(){const e=D.i.text,t=(0,se.xz)(e),{error:s}=await x.G.from("chat").insert({username:this.user,message:t,chatRoom:this.chatRoom});if(s)throw new Error("send chat failed.");D.i.setChatTextValue(this.newMessage),z.emit("clearChatTextarea"),this.scrollToBottom()},realtimeListener(){x.G.channel("chat").on("postgres_changes",{event:"INSERT",schema:"public",table:"chat"},(e=>{const t=(0,se.i_)(e.new.message);e.new.message=t,this.messages.push(e.new),this.newMessageSound()})).subscribe()},async deleteMessage(e){this.messages.pop();const{error:t}=await x.G.from("chat").delete().eq("id",e);if(t)throw new Error("chat message deletion failed.")},loadChatRoom(){const e=this.$route.params.link,t=e.slice(0,60);this.chatRoom=t},loadUsername(){const e=D.i.username;this.user=e},receiveMessageEventBus(){z.on("sendMessage",(()=>{this.sendMessage()}))},scrollToBottom(){window.scrollTo(0,document.body.scrollHeight)},newMessageSound(){this.$refs.newMessageSound.play()}}});const ne=(0,N.c)(ae,[["render",T],["__scopeId","data-v-27ecd15a"]]);var re=ne}}]);
//# sourceMappingURL=952.10e72806.js.map